---
description: 
globs: 
alwaysApply: false
---

# ğŸ—ï¸ Hexagonal Architecture + DDD ë„ë©”ì¸ ìƒì„± ê·œì¹™

## ï¿½ï¿½ 1. í´ë” êµ¬ì¡° ê·œì¹™

### í•„ìˆ˜ í´ë” êµ¬ì¡°
```
{{ë„ë©”ì¸ëª…}}/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ model/           # í•µì‹¬ ë„ë©”ì¸ ì—”í‹°í‹°
â”‚   â””â”€â”€ vo/              # Value Objects
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ command/         # ì™¸ë¶€ ìš”ì²­ ë³€í™˜
â”‚   â”œâ”€â”€ result/          # ë„ë©”ì¸ ì‘ë‹µ ê²°ê³¼
â”‚   â”œâ”€â”€ service/         # íŠ¸ëœì­ì…˜ ê´€ë¦¬
â”‚   â”œâ”€â”€ usecase/         # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â””â”€â”€ port/
â”‚       â”œâ”€â”€ inbound/     # ì…ë ¥ í¬íŠ¸ (í•„ìš”ì‹œ)
â”‚       â””â”€â”€ outbound/    # ì¶œë ¥ í¬íŠ¸
â””â”€â”€ adapter/
    â”œâ”€â”€ in/              # ì…ë ¥ ì–´ëŒ‘í„°
    â”‚   â””â”€â”€ graphql/     # GraphQL ì–´ëŒ‘í„°
    â”‚       â”œâ”€â”€ datafetcher/
    â”‚       â”œâ”€â”€ mapper/
    â”‚       â””â”€â”€ dto/
    â””â”€â”€ out/             # ì¶œë ¥ ì–´ëŒ‘í„° (í•„ìš”ì‹œ)
        â””â”€â”€ persistence/ # JPA ì–´ëŒ‘í„°
            â”œâ”€â”€ entity/
            â””â”€â”€ repository/
```

## ï¿½ï¿½ï¸ 2. ê³„ì¸µë³„ ì±…ì„ ê·œì¹™

### Domain Layer
- **model/**: í•µì‹¬ ë„ë©”ì¸ ì—”í‹°í‹°ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
  - `data class` ì‚¬ìš©, ë¶ˆë³€ì„± ë³´ì¥
  - `init` ë¸”ë¡ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì¦
  - ë„ë©”ì¸ ë©”ì„œë“œ í¬í•¨ (`isCreatedAfter`, `matchesKeyword` ë“±)
- **vo/**: íƒ€ì… ì•ˆì „í•œ ê°’ ê°ì²´
  - `@JvmInline value class` ì‚¬ìš©
  - DB ID: `{Entity}Id`
  - ë¹„ì¦ˆë‹ˆìŠ¤ ê°œë…: `{Entity}{Attribute}`

### Application Layer
- **command/**: ì™¸ë¶€ ìš”ì²­ì„ ë„ë©”ì¸ ëª¨ë¸ë¡œ ë³€í™˜
  - `companion object`ì— íŒ©í† ë¦¬ ë©”ì„œë“œ (`fromGraphql`, `fromRest` ë“±)
  - ìœ íš¨ì„± ê²€ì¦ í¬í•¨
- **result/**: ë„ë©”ì¸ ëª¨ë¸ì„ ì™¸ë¶€ ì‘ë‹µìš©ìœ¼ë¡œ ë³€í™˜
  - `companion object`ì— `from()` íŒ©í† ë¦¬ ë©”ì„œë“œ
  - í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ í¬í•¨
- **service/**: íŠ¸ëœì­ì…˜ ê´€ë¦¬ì™€ ì–´ëŒ‘í„° ì—°ê²°
  - `@Service`, `@Transactional` ì‚¬ìš©
  - UseCase í˜¸ì¶œ í›„ Mapperë¡œ ë³€í™˜
- **usecase/**: íŠ¹ì • ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
  - ìˆœìˆ˜í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ orchestration
  - Portë¥¼ í†µí•´ì„œë§Œ ì™¸ë¶€ì™€ ì—°ê²°
- **port/**: ì™¸ë¶€ì™€ì˜ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
  - Domain ëª¨ë¸ì„ ë°˜í™˜í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤

### Adapter Layer
- **in/graphql/datafetcher/**: GraphQL ì§„ì…ì 
  - `@DgsComponent` ì‚¬ìš©
  - Service ê³„ì¸µë§Œ í˜¸ì¶œ
- **in/graphql/mapper/**: Application ê²°ê³¼ë¥¼ DGS Codegen íƒ€ì…ìœ¼ë¡œ ë³€í™˜
  - `object`ë¡œ êµ¬í˜„ (ìƒíƒœ ì—†ìŒ)
  - `types` íŒ¨í‚¤ì§€ì˜ ìƒì„±ëœ íƒ€ì… ì‚¬ìš©
- **in/graphql/dto/**: GraphQL ìš”ì²­ ì „ìš© DTO
  - ì…ë ¥ íŒŒë¼ë¯¸í„° ìº¡ìŠí™”
- **out/persistence/repository/**: Port ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´
  - `@Repository` ì‚¬ìš©
  - QueryRepository + Mapper + CrudRepository ì¡°í•©
  - JPO â†” Domain ë³€í™˜ì€ Mapper ì‚¬ìš©
- **out/persistence/mapper/**: JPO â†” Domain ëª¨ë¸ ë³€í™˜
  - `@Component` ì‚¬ìš©
  - `toDomain()`, `toJpo()`, `toDomainList()` ë©”ì„œë“œ êµ¬í˜„
- **out/persistence/entity/**: JPA ì—”í‹°í‹°
  - `@Entity` ì‚¬ìš©
  - Domain ëª¨ë¸ê³¼ ë…ë¦½ì ì¸ DB ìŠ¤í‚¤ë§ˆ
- **out/persistence/dataloader/**: GraphQL DataLoader (í•„ìš”ì‹œ)
  - N+1 ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ DataLoader êµ¬í˜„
  - Legacy í´ë”ì— ì—°ê´€ê´€ê³„ê°€ ìˆëŠ” ê²½ìš° í•„ìˆ˜
  - Batch ë¡œë”© ë¡œì§ í¬í•¨

## ğŸ¯ 3. ëª…ëª… ê·œì¹™

### í´ë˜ìŠ¤ ëª…ëª… íŒ¨í„´
```kotlin
// Domain
data class {{ë„ë©”ì¸ëª…}}(...)                    // í•µì‹¬ ì—”í‹°í‹°
data class {{ë„ë©”ì¸ëª…}}SearchCriteria(...)      // ê²€ìƒ‰ ì¡°ê±´
@JvmInline value class {{ë„ë©”ì¸ëª…}}Id(val value: Long)  // ID VO

// Application
data class {{ë„ë©”ì¸ëª…}}SearchCommand(...)       // ëª…ë ¹ ê°ì²´
data class {{ë„ë©”ì¸ëª…}}SearchResult(...)        // ê²€ìƒ‰ ê²°ê³¼
data class {{ë„ë©”ì¸ëª…}}Result(...)              // ê°œë³„ ê²°ê³¼
class {{ë„ë©”ì¸ëª…}}SearchUseCase(...)            // ìœ ìŠ¤ì¼€ì´ìŠ¤
class {{ë„ë©”ì¸ëª…}}Service(...)                  // ì„œë¹„ìŠ¤
interface {{ë„ë©”ì¸ëª…}}Repository                // í¬íŠ¸

// Adapter
class {{ë„ë©”ì¸ëª…}}Fetcher(...)                  // GraphQL ì§„ì…ì 
object {{ë„ë©”ì¸ëª…}}OutputMapper                 // ì‘ë‹µ ë³€í™˜
data class {{ë„ë©”ì¸ëª…}}Request(...)             // ìš”ì²­ DTO
```

## ğŸ”„ 4. ì˜ì¡´ì„± ë°©í–¥ ê·œì¹™

### í—ˆìš©ë˜ëŠ” ì˜ì¡´ì„±
```
Adapter(in) â†’ Application â†’ Domain
Adapter(out) â†’ Application â†’ Domain
Application â†’ Domain
```

### ê¸ˆì§€ë˜ëŠ” ì˜ì¡´ì„±
```
âŒ Domain â†’ Application
âŒ Domain â†’ Adapter
âŒ Application â†’ Adapter
âŒ Adapter â†’ Adapter (ë‹¤ë¥¸ ì–´ëŒ‘í„°)
```

## ğŸ­ 5. ìƒì„± íŒ¨í„´ ê·œì¹™

### Factory Method íŒ¨í„´
```kotlin
// Command
companion object {
    fun fromGraphql(filter: FilterInput?, pagination: PaginationInput?): {{ë„ë©”ì¸ëª…}}SearchCommand
}

// Result
companion object {
    fun from(domain: {{ë„ë©”ì¸ëª…}}): {{ë„ë©”ì¸ëª…}}Result
}

// VO
companion object {
    fun from(value: String): {{ë„ë©”ì¸ëª…}}Id
}
```

### Mapper íŒ¨í„´
```kotlin
object {{ë„ë©”ì¸ëª…}}OutputMapper {
    fun mapTo{{ë„ë©”ì¸ëª…}}Output(result: {{ë„ë©”ì¸ëª…}}SearchResult): {{ë„ë©”ì¸ëª…}}Output {
        // DGS Codegen íƒ€ì…ìœ¼ë¡œ ë³€í™˜
    }
}
```

## ï¿½ï¿½ 6. í…ŒìŠ¤íŠ¸ ê·œì¹™

### í…ŒìŠ¤íŠ¸ ìœ„ì¹˜
```
src/test/kotlin/kr/co/marketbill/marketbillcoreserver/{{ë„ë©”ì¸ëª…}}/
â”œâ”€â”€ domain/
â”œâ”€â”€ application/
â””â”€â”€ adapter/
```

### í…ŒìŠ¤íŠ¸ ëª…ëª…
```kotlin
class {{ë„ë©”ì¸ëª…}}FetcherTest
class {{ë„ë©”ì¸ëª…}}ServiceTest
class {{ë„ë©”ì¸ëª…}}UseCaseTest
```

## ï¿½ï¿½ 7. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆë¡œìš´ ë„ë©”ì¸ ìƒì„± ì‹œ ë‹¤ìŒ í•­ëª©ë“¤ì„ í™•ì¸í•˜ì„¸ìš”:

### Domain Layer
- [ ] `data class`ë¡œ ì—”í‹°í‹° ì •ì˜
- [ ] `init` ë¸”ë¡ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì¦
- [ ] ë„ë©”ì¸ ë©”ì„œë“œ í¬í•¨
- [ ] `@JvmInline value class`ë¡œ VO ì •ì˜
- [ ] `companion object`ì— íŒ©í† ë¦¬ ë©”ì„œë“œ

### Application Layer
- [ ] Commandì— `fromGraphql` íŒ©í† ë¦¬ ë©”ì„œë“œ
- [ ] Resultì— `from()` íŒ©í† ë¦¬ ë©”ì„œë“œ
- [ ] UseCaseëŠ” ìˆœìˆ˜í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ
- [ ] Serviceì— `@Transactional` ì ìš©
- [ ] Port ì¸í„°í˜ì´ìŠ¤ ì •ì˜

### Adapter Layer
- [ ] Fetcherì— `@DgsComponent` ì ìš©
- [ ] MapperëŠ” `object`ë¡œ êµ¬í˜„
- [ ] DGS Codegen íƒ€ì… ì‚¬ìš©
- [ ] Serviceë§Œ í˜¸ì¶œ

### ì˜ì¡´ì„± ê²€ì¦
- [ ] Domainì€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ
- [ ] Applicationì€ Portë§Œ ì°¸ì¡°
- [ ] AdapterëŠ” Applicationë§Œ ì°¸ì¡°

## âš ï¸ 8. ì£¼ì˜ì‚¬í•­

1. **GraphQL ì‘ë‹µì€ ë°˜ë“œì‹œ DGS Codegen íƒ€ì… ì‚¬ìš©**
2. **Domainì€ ì ˆëŒ€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¸ˆì§€**
3. **Adapter ê°„ ì§ì ‘ ì°¸ì¡° ê¸ˆì§€**
4. **ëª¨ë“  ë„ë©”ì¸ ê°ì²´ëŠ” ë¶ˆë³€ì„± ë³´ì¥**
5. **íŒ©í† ë¦¬ ë©”ì„œë“œëŠ” `companion object`ì— ì •ì˜**

## ï¿½ï¿½ï¸ 9. RepositoryImpl êµ¬í˜„ ê·œì¹™

### RepositoryImpl êµ¬ì¡°
```kotlin
@Repository
class {{ë„ë©”ì¸ëª…}}RepositoryImpl(
    private val {{ë„ë©”ì¸ëª…}}QueryRepository: {{ë„ë©”ì¸ëª…}}QueryRepository,
    private val {{ë„ë©”ì¸ëª…}}Mapper: {{ë„ë©”ì¸ëª…}}Mapper,
    private val crudRepository: {{ë„ë©”ì¸ëª…}}CrudRepository,
) : {{ë„ë©”ì¸ëª…}}Repository {
    // Port ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
}
```

### êµ¬ì„± ìš”ì†Œ ì—­í• 
- **QueryRepository**: ë³µì¡í•œ ê²€ìƒ‰/ì¡°íšŒ ì¿¼ë¦¬ ì²˜ë¦¬ (QueryDSL ê¸°ë°˜)
- **Mapper**: JPO â†” Domain ëª¨ë¸ ë³€í™˜
- **CrudRepository**: ë‹¨ìˆœ CRUD ì‘ì—… (JPA Repository)

### ë©”ì„œë“œ êµ¬í˜„ íŒ¨í„´
```kotlin
// ê²€ìƒ‰ ë©”ì„œë“œ
override fun find{{ë„ë©”ì¸ëª…}}sWithCriteria(
    criteria: {{ë„ë©”ì¸ëª…}}SearchCriteria,
    pageInfo: PageInfo
): PageResult<{{ë„ë©”ì¸ëª…}}> {
    val jpoPage = {{ë„ë©”ì¸ëª…}}QueryRepository.find{{ë„ë©”ì¸ëª…}}sWithDynamicQuery(criteria, pageInfo)
    val domain{{ë„ë©”ì¸ëª…}}s = {{ë„ë©”ì¸ëª…}}Mapper.toDomainList(jpoPage.content)
    
    return PageResult(
        content = domain{{ë„ë©”ì¸ëª…}}s,
        pageInfo = pageInfo,
        totalElements = jpoPage.totalElements
    )
}

// ë‹¨ìˆœ ì¡°íšŒ ë©”ì„œë“œ
override fun findById(id: {{ë„ë©”ì¸ëª…}}Id): {{ë„ë©”ì¸ëª…}}? {
    val jpo = crudRepository.findById(id.value).orElse(null)
    return jpo?.let { {{ë„ë©”ì¸ëª…}}Mapper.toDomain(it) }
}

// ì €ì¥ ë©”ì„œë“œ
override fun save({{ë„ë©”ì¸ëª…}}: {{ë„ë©”ì¸ëª…}}): {{ë„ë©”ì¸ëª…}} {
    val jpo = {{ë„ë©”ì¸ëª…}}Mapper.toJpo({{ë„ë©”ì¸ëª…}})
    val savedJpo = crudRepository.save(jpo)
    return {{ë„ë©”ì¸ëª…}}Mapper.toDomain(savedJpo)
}
```

### QueryRepository êµ¬í˜„ ê·œì¹™
```kotlin
@Repository
interface {{ë„ë©”ì¸ëª…}}QueryRepository {
    fun find{{ë„ë©”ì¸ëª…}}sWithDynamicQuery(
        criteria: {{ë„ë©”ì¸ëª…}}SearchCriteria, 
        pageInfo: PageInfo
    ): Page<{{ë„ë©”ì¸ëª…}}Jpo>
}
```

### Mapper êµ¬í˜„ ê·œì¹™
```kotlin
@Component
class {{ë„ë©”ì¸ëª…}}Mapper {
    fun toDomain(jpo: {{ë„ë©”ì¸ëª…}}Jpo): {{ë„ë©”ì¸ëª…}}
    fun toJpo(domain: {{ë„ë©”ì¸ëª…}}): {{ë„ë©”ì¸ëª…}}Jpo
    fun toDomainList(jpos: List<{{ë„ë©”ì¸ëª…}}Jpo>): List<{{ë„ë©”ì¸ëª…}}>
}
```

### RepositoryImpl ì²´í¬ë¦¬ìŠ¤íŠ¸
ìƒˆë¡œìš´ RepositoryImpl ìƒì„± ì‹œ:

- [ ] **QueryRepository + Mapper + CrudRepository ì¡°í•©** ì‚¬ìš©
- [ ] **@Repository** ì–´ë…¸í…Œì´ì…˜ ì ìš©
- [ ] **JPO â†” Domain ë³€í™˜ì€ Mapper ì‚¬ìš©**
- [ ] **ë³µì¡í•œ ì¿¼ë¦¬ëŠ” QueryRepository ìœ„ì„**
- [ ] **ë‹¨ìˆœ CRUDëŠ” CrudRepository ìœ„ì„**
- [ ] **Port ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì„œë“œ êµ¬í˜„**

## ï¿½ï¿½ï¸ 10. JPO Entity êµ¬í˜„ ê·œì¹™

### JPO Entity êµ¬ì¡°
```kotlin
@Entity
@Table(
    name = "{{í…Œì´ë¸”ëª…}}", 
    indexes = [
        Index(name = "idx_{{í…Œì´ë¸”ëª…}}_created_at", columnList = "created_at"),
        // í•„ìš”í•œ ì¸ë±ìŠ¤ ì¶”ê°€
    ]
)
class {{ë„ë©”ì¸ëª…}}Jpo(
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long? = null,
    
    // í•„ë“œë“¤...
    
) : BaseJpo() {
    companion object {
        fun create(/* íŒŒë¼ë¯¸í„° */): {{ë„ë©”ì¸ëª…}}Jpo {
            // ìœ íš¨ì„± ê²€ì¦
            return {{ë„ë©”ì¸ëª…}}Jpo(/* ê°’ë“¤ */)
        }
    }
    
    override fun equals(other: Any?): Boolean {
        if (this === other) return true
        if (other !is {{ë„ë©”ì¸ëª…}}Jpo) return false
        return id != null && id == other.id
    }
    
    override fun hashCode(): Int = javaClass.hashCode()
}
```

### Entity ê´€ê³„ ë§¤í•‘ ê·œì¹™
- **@ManyToOne**: fetch = FetchType.LAZY (ê¸°ë³¸ê°’)
- **@OneToMany**: fetch = FetchType.LAZY, cascade = [CascadeType.REMOVE]
- **@OneToOne**: fetch = FetchType.EAGER (ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²½ìš°)
- **orphanRemoval = true**: ë¶€ëª¨ ì‚­ì œ ì‹œ ìì‹ë„ ì‚­ì œ

### JPO Entity ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] **BaseJpo ìƒì†**
- [ ] **@Entity, @Table ì–´ë…¸í…Œì´ì…˜**
- [ ] **í•„ìš”í•œ ì¸ë±ìŠ¤ ì„¤ì •**
- [ ] **companion objectì— create() íŒ©í† ë¦¬ ë©”ì„œë“œ**
- [ ] **equals/hashCode ì˜¤ë²„ë¼ì´ë“œ**
- [ ] **Entity ê´€ê³„ ë§¤í•‘ ì„¤ì •**

##ï¸ 11. Types íŒ¨í‚¤ì§€ ì‚¬ìš© ê¸°ì¤€

### Types íŒ¨í‚¤ì§€ë€?
- **DGS Codegen**ìœ¼ë¡œ ìë™ ìƒì„±ë˜ëŠ” GraphQL íƒ€ì…ë“¤
- `src/main/kotlin/kr/co/marketbill/marketbillcoreserver/types/` íŒ¨í‚¤ì§€ì— ìœ„ì¹˜
- GraphQL ìŠ¤í‚¤ë§ˆì—ì„œ ì •ì˜ëœ Input, Output íƒ€ì…ë“¤

### ì–¸ì œ Types íŒ¨í‚¤ì§€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê°€?

#### 1. **GraphQL Input íƒ€ì… ì‚¬ìš©**
```kotlin
// âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš© - GraphQL Input
@DgsComponent
class {{ë„ë©”ì¸ëª…}}Fetcher {
    fun get{{ë„ë©”ì¸ëª…}}s(
        @InputArgument filter: {{ë„ë©”ì¸ëª…}}FilterInput?,  // types íŒ¨í‚¤ì§€ ì‚¬ìš©
        @InputArgument pagination: PaginationInput?      // types íŒ¨í‚¤ì§€ ì‚¬ìš©
    ): {{ë„ë©”ì¸ëª…}}sOutput {
        // ...
    }
}
```

#### 2. **GraphQL Output íƒ€ì… ì‚¬ìš©**
```kotlin
// âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš© - GraphQL Output
object {{ë„ë©”ì¸ëª…}}OutputMapper {
    fun mapTo{{ë„ë©”ì¸ëª…}}sOutput(result: {{ë„ë©”ì¸ëª…}}SearchResult): {{ë„ë©”ì¸ëª…}}sOutput {
        // types íŒ¨í‚¤ì§€ì˜ {{ë„ë©”ì¸ëª…}}sOutput ì‚¬ìš©
        return {{ë„ë©”ì¸ëª…}}sOutput(
            resultCount = result.totalElements,
            items = result.{{ë„ë©”ì¸ëª…}}s.map { mapTo{{ë„ë©”ì¸ëª…}}Output(it) }
        )
    }
}
```

#### 3. **ì‚¬ìš© ê¸ˆì§€ ì¼€ì´ìŠ¤**
```kotlin
// âŒ ì˜ëª»ëœ ì‚¬ìš© - Application Layerì—ì„œ types íŒ¨í‚¤ì§€ ì‚¬ìš©
class {{ë„ë©”ì¸ëª…}}Service {
    fun get{{ë„ë©”ì¸ëª…}}s(filter: {{ë„ë©”ì¸ëª…}}FilterInput?): {{ë„ë©”ì¸ëª…}}sOutput {
        // Application LayerëŠ” types íŒ¨í‚¤ì§€ ì‚¬ìš© ê¸ˆì§€
    }
}

// âŒ ì˜ëª»ëœ ì‚¬ìš© - Domain Layerì—ì„œ types íŒ¨í‚¤ì§€ ì‚¬ìš©
data class {{ë„ë©”ì¸ëª…}}(
    val id: {{ë„ë©”ì¸ëª…}}Id,
    val name: String,
    val type: {{ë„ë©”ì¸ëª…}}Type  // types íŒ¨í‚¤ì§€ ì‚¬ìš© ê¸ˆì§€
)
```

### Types íŒ¨í‚¤ì§€ ì‚¬ìš© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] **GraphQL Input/Output íƒ€ì…ë§Œ ì‚¬ìš©**
- [ ] **Adapter Layerì—ì„œë§Œ ì‚¬ìš©**
- [ ] **Application Layerì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€**
- [ ] **Domain Layerì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€**
- [ ] **DGS Codegenìœ¼ë¡œ ìë™ ìƒì„±ëœ íƒ€ì…ë§Œ ì‚¬ìš©**

##ï¸ 12. DataLoader ì‚¬ìš© ê¸°ì¤€

### DataLoaderë€?
- **DGS Framework**ì˜ N+1 ë¬¸ì œ í•´ê²° ë„êµ¬
- GraphQLì—ì„œ ì—°ê´€ê´€ê³„ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ë¡œë”©
- Batch ë¡œë”©ì„ í†µí•œ ì„±ëŠ¥ ìµœì í™”

### ì–¸ì œ DataLoaderë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê°€?

#### 1. **Legacy í´ë”ì— ì—°ê´€ê´€ê³„ê°€ ìˆëŠ” ê²½ìš°**
```kotlin
// âœ… Legacy í´ë”ì— ì—°ê´€ê´€ê³„ê°€ ìˆìœ¼ë©´ DataLoader ì‚¬ìš©
// legacy/domain/entity/user/User.kt
@Entity
class User {
    @OneToMany(mappedBy = "retailer")
    val appliedConnections: List<BizConnection> = listOf()
    
    @OneToMany(mappedBy = "wholesaler") 
    val receivedConnections: List<BizConnection> = listOf()
}

// â†’ DataLoader êµ¬í˜„ í•„ìš”
@DgsDataLoader(name = "appliedConnections")
class AppliedConnectionLoader : MappedBatchLoaderWithContext<Long, List<BizConnection>>
```

#### 2. **GraphQL Fieldì—ì„œ ì—°ê´€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°**
```kotlin
// âœ… GraphQL Fieldì—ì„œ ì—°ê´€ ë°ì´í„° ë¡œë”©
@DgsData(parentType = "User", field = "appliedConnections")
fun appliedConnections(
    dfe: DgsDataFetchingEnvironment,
    @InputArgument pagination: PaginationInput?
): CompletableFuture<List<BizConnection>> {
    val user = dfe.getSource<User>()
    val dataLoader = dfe.getDataLoader<Long, List<BizConnection>>(AppliedConnectionLoader::class.java)
    return dataLoader.load(user.id)
}
```

#### 3. **ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°**
```kotlin
// âŒ ë‹¨ìˆœ ì¡°íšŒëŠ” DataLoader ë¶ˆí•„ìš”
@DgsQuery(field = "getUser")
fun getUser(@InputArgument id: Long): User {
    return userService.getUser(id)  // ë‹¨ìˆœ ì¡°íšŒëŠ” DataLoader ë¶ˆí•„ìš”
}

// âŒ ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ê²½ìš°
data class {{ë„ë©”ì¸ëª…}}(
    val id: {{ë„ë©”ì¸ëª…}}Id,
    val name: String,
    val description: String  // ì—°ê´€ê´€ê³„ ì—†ìŒ â†’ DataLoader ë¶ˆí•„ìš”
)
```

### DataLoader êµ¬í˜„ ê·œì¹™
```kotlin
@DgsDataLoader(name = "{{ë„ë©”ì¸ëª…}}Loader")
class {{ë„ë©”ì¸ëª…}}Loader : MappedBatchLoaderWithContext<Long, List<{{ë„ë©”ì¸ëª…}}>> {
    
    @Autowired
    private lateinit var {{ë„ë©”ì¸ëª…}}Service: {{ë„ë©”ì¸ëª…}}Service
    
    override fun load(
        keys: Set<Long>, 
        environment: BatchLoaderEnvironment
    ): CompletionStage<Map<Long, List<{{ë„ë©”ì¸ëª…}}>>> {
        // Batch ë¡œë”© ë¡œì§ êµ¬í˜„
        val results = {{ë„ë©”ì¸ëª…}}Service.findByParentIds(keys)
        return CompletableFuture.completedFuture(results)
    }
}
```

### DataLoader ì‚¬ìš© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] **Legacy í´ë”ì— ì—°ê´€ê´€ê³„ê°€ ìˆëŠ”ì§€ í™•ì¸**
- [ ] **GraphQL Fieldì—ì„œ ì—°ê´€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ì§€ í™•ì¸**
- [ ] **N+1 ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸**
- [ ] **Batch ë¡œë”©ì´ ê°€ëŠ¥í•œì§€ í™•ì¸**
- [ ] **DataLoader êµ¬í˜„ì²´ ìƒì„±**
- [ ] **GraphQL Fieldì—ì„œ DataLoader ì‚¬ìš©**

---

# ï¿½ï¿½ Legacy í´ë” ë¶„ì„ ë° ë„ë©”ì¸ ì •ë³´ ì°¾ê¸° ê°€ì´ë“œ

## ğŸ“ Legacy í´ë” êµ¬ì¡° ë¶„ì„

### Legacy vs New Architecture ë¹„êµ

| êµ¬ë¶„ | Legacy êµ¬ì¡° | New Architecture (Flower) |
|------|-------------|---------------------------|
| **ë„ë©”ì¸ ë¶„ë¦¬** | âŒ ë‹¨ì¼ `legacy` í´ë”ì— ëª¨ë“  ë„ë©”ì¸ í˜¼ì¬ | âœ… ê° ë„ë©”ì¸ë³„ ë…ë¦½ í´ë” |
| **ê³„ì¸µ ë¶„ë¦¬** | âŒ `application`, `domain`, `infrastructure` í˜¼ì¬ | âœ… ëª…í™•í•œ Hexagonal Architecture |
| **DTO ìœ„ì¹˜** | âŒ `legacy/application/dto/response/` | âœ… `adapter/in/graphql/dto/` |
| **Repository** | âŒ `legacy/infrastructure/repository/` | âœ… `adapter/out/persistence/repository/` |
| **GraphQL** | âŒ `legacy/graphql/datafetcher/` | âœ… `adapter/in/graphql/datafetcher/` |


---

## ï¿½ï¿½ ë„ë©”ì¸ ì •ë³´ ì°¾ê¸° ê°€ì´ë“œ

### 1. ê¸°ì¡´ ë„ë©”ì¸ ì •ë³´ ì°¾ê¸°

ìƒˆë¡œìš´ ë„ë©”ì¸ì„ ìƒì„±í•  ë•Œ, ë‹¤ìŒ ìœ„ì¹˜ì—ì„œ ê¸°ì¡´ ë„ë©”ì¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

#### A. Legacy ì‘ë‹µ DTO (ê¸°ì¡´ API ì‘ë‹µ êµ¬ì¡°)
```
legacy/application/dto/response/
â”œâ”€â”€ FlowersOutput.kt          # ê½ƒ ëª©ë¡ ì‘ë‹µ
â”œâ”€â”€ GetFlowersOutput.kt       # ê½ƒ ì¡°íšŒ ì‘ë‹µ
â”œâ”€â”€ CartItemsOutput.kt        # ì¥ë°”êµ¬ë‹ˆ ì‘ë‹µ
â”œâ”€â”€ OrderSheetsAggregate.kt   # ì£¼ë¬¸ì„œ ì‘ë‹µ
â””â”€â”€ ...
```

#### B. Legacy ì—”í‹°í‹° (ê¸°ì¡´ ë°ì´í„° ëª¨ë¸)
```
legacy/domain/entity/
â”œâ”€â”€ order/
â”‚   â”œâ”€â”€ CartItem.kt           # ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ
â”‚   â”œâ”€â”€ OrderSheet.kt         # ì£¼ë¬¸ì„œ
â”‚   â”œâ”€â”€ OrderItem.kt          # ì£¼ë¬¸ ì•„ì´í…œ
â”‚   â””â”€â”€ ...
â””â”€â”€ common/
    â””â”€â”€ BaseTime.kt           # ê³µí†µ ì‹œê°„ ì •ë³´
```

#### C. Legacy Repository (ê¸°ì¡´ ë°ì´í„° ì ‘ê·¼)
```
legacy/infrastructure/repository/
â”œâ”€â”€ order/
â”‚   â”œâ”€â”€ CartItemRepository.kt     # ì¥ë°”êµ¬ë‹ˆ ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ OrderSheetRepository.kt   # ì£¼ë¬¸ì„œ ì €ì¥ì†Œ
â”‚   â””â”€â”€ ...
â””â”€â”€ user/
    â””â”€â”€ ...
```

#### D. Legacy GraphQL (ê¸°ì¡´ API ì—”ë“œí¬ì¸íŠ¸)
{ë„ë©”ì¸}.graphql ì— ì •ì˜ëœ ê¸°ì¤€ìœ¼ë¡œë§Œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
```
legacy/graphql/datafetcher/
â”œâ”€â”€ OrderFetcher.kt           # ì£¼ë¬¸ ê´€ë ¨ ì¿¼ë¦¬
â”œâ”€â”€ UserFetcher.kt            # ì‚¬ìš©ì ê´€ë ¨ ì¿¼ë¦¬
â”œâ”€â”€ CommonFetcher.kt          # ê³µí†µ ì¿¼ë¦¬
â””â”€â”€ ...
```

### 2. ë„ë©”ì¸ ì •ë³´ ì¶”ì¶œ í”„ë¡œì„¸ìŠ¤

ìƒˆë¡œìš´ ë„ë©”ì¸ `{{ë„ë©”ì¸ëª…}}`ì„ ìƒì„±í•  ë•Œ:

#### Step 1: Legacy ì‘ë‹µ DTO ë¶„ì„
```kotlin
// legacy/application/dto/response/{{ë„ë©”ì¸ëª…}}Output.kt
data class {{ë„ë©”ì¸ëª…}}Output(
    val resultCount: Long,
    val items: Page<{{ë„ë©”ì¸ëª…}}>
)
```

#### Step 2: Legacy ì—”í‹°í‹° ë¶„ì„
```kotlin
// legacy/domain/entity/{{ë„ë©”ì¸ëª…}}/{{ë„ë©”ì¸ëª…}}.kt
@Entity
class {{ë„ë©”ì¸ëª…}} : BaseTime() {
    // ê¸°ì¡´ í•„ë“œë“¤ ë¶„ì„
}
```

#### Step 3: Legacy Repository ë¶„ì„
```kotlin
// legacy/infrastructure/repository/{{ë„ë©”ì¸ëª…}}/{{ë„ë©”ì¸ëª…}}Repository.kt
interface {{ë„ë©”ì¸ëª…}}Repository : JpaRepository<{{ë„ë©”ì¸ëª…}}, Long> {
    // ê¸°ì¡´ ì¿¼ë¦¬ ë©”ì„œë“œë“¤ ë¶„ì„
}
```

#### Step 4: Legacy GraphQL ë¶„ì„
```kotlin
// legacy/graphql/datafetcher/{{ë„ë©”ì¸ëª…}}Fetcher.kt
@DgsComponent
class {{ë„ë©”ì¸ëª…}}Fetcher {
    // ê¸°ì¡´ API ì—”ë“œí¬ì¸íŠ¸ ë¶„ì„
}
```

### 3. ë„ë©”ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

Legacy â†’ New Architecture ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ:

#### A. ì‘ë‹µ êµ¬ì¡° ë¶„ì„
- [ ] `legacy/application/dto/response/{{ë„ë©”ì¸ëª…}}Output.kt` ë¶„ì„
- [ ] ê¸°ì¡´ ì‘ë‹µ í•„ë“œë“¤ì„ `application/result/{{ë„ë©”ì¸ëª…}}Result.kt`ë¡œ ë³€í™˜
- [ ] DGS Codegen íƒ€ì…ê³¼ ë§¤í•‘ ê´€ê³„ í™•ì¸

#### B. ë°ì´í„° ëª¨ë¸ ë¶„ì„
- [ ] `legacy/domain/entity/{{ë„ë©”ì¸ëª…}}/{{ë„ë©”ì¸ëª…}}.kt` ë¶„ì„
- [ ] JPA ì—”í‹°í‹°ë¥¼ ë„ë©”ì¸ ëª¨ë¸ë¡œ ë³€í™˜
- [ ] VO ë¶„ë¦¬ (`{{ë„ë©”ì¸ëª…}}Id`, `{{ë„ë©”ì¸ëª…}}ImageUrl` ë“±)

#### C. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ì„
- [ ] `legacy/infrastructure/repository/{{ë„ë©”ì¸ëª…}}/{{ë„ë©”ì¸ëª…}}Repository.kt` ë¶„ì„
- [ ] ê¸°ì¡´ ì¿¼ë¦¬ ë¡œì§ì„ UseCaseë¡œ ë³€í™˜
- [ ] Port ì¸í„°í˜ì´ìŠ¤ ì •ì˜

#### D. API ì—”ë“œí¬ì¸íŠ¸ ë¶„ì„
- [ ] `legacy/graphql/datafetcher/{{ë„ë©”ì¸ëª…}}Fetcher.kt` ë¶„ì„
- [ ] ê¸°ì¡´ APIë¥¼ ìƒˆë¡œìš´ Fetcherë¡œ ë³€í™˜
- [ ] Command/Result íŒ¨í„´ ì ìš©

### 4. ì‹¤ì œ ì˜ˆì‹œ: Flower ë„ë©”ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜

#### Legacy â†’ New Architecture ë³€í™˜

```kotlin
// Legacy ì‘ë‹µ DTO
// legacy/application/dto/response/FlowersOutput.kt
data class FlowersOutput(
    val resultCount: Long,
    val items: Page<Flower>
)

// â†“ ë³€í™˜

// New Application Result
// flower/application/result/FlowerSearchResult.kt
data class FlowerSearchResult(
    val flowers: List<FlowerResult>,
    val totalElements: Long,
    val totalPages: Int,
    val currentPage: Int,
    val hasNext: Boolean
)

// New Adapter Mapper
// flower/adapter/in/graphql/mapper/FlowerOutputMapper.kt
object FlowerOutputMapper {
    fun mapToFlowersOutput(result: FlowerSearchResult): FlowersOutput {
        // DGS Codegen íƒ€ì…ìœ¼ë¡œ ë³€í™˜
    }
}
```

## ï¿½ï¿½ ê²°ë¡ 

ìƒˆë¡œìš´ ë„ë©”ì¸ì„ ìƒì„±í•  ë•Œ:

1. **Legacy í´ë”ì—ì„œ ê¸°ì¡´ ë„ë©”ì¸ ì •ë³´ ì°¾ê¸°**
2. **ê¸°ì¡´ ì‘ë‹µ êµ¬ì¡°, ì—”í‹°í‹°, Repository, GraphQL ë¶„ì„**
3. **Hexagonal Architecture + DDD ì›ì¹™ì— ë”°ë¼ ìƒˆ êµ¬ì¡°ë¡œ ë³€í™˜**
4. **Flower ë„ë©”ì¸ì„ í‘œì¤€ í…œí”Œë¦¿ìœ¼ë¡œ í™œìš©**

ì´ë ‡ê²Œ í•˜ë©´ ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë³´ì¡´í•˜ë©´ì„œ ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

