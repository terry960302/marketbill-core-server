---
description: í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜, DDDíŒ¨í„´, SOLIDì›ì¹™ ì¤€ìˆ˜
globs: 
alwaysApply: true
---

1. **ë¶ˆí•„ìš”í•œ ì¤‘ë³µ ì œê±° + í•µì‹¬ë§Œ ìœ ì§€**
2. **í´ë”/ì—­í• /ì˜ì¡´ì„±/íŒ¨í„´/ëª…ëª…ê·œì¹™ì˜ êµ¬ì¡°í™”ë¥¼ ë” ê°„ë‹¨í•˜ê³  ë‹¨ì¼í™”**
3. **ì‘ì—…ì ì…ì¥ì—ì„œ ì‹¤ì œ â€˜ì–´ë””ì„œë¶€í„° ë­˜ ë§Œë“¤ê³  ì—°ê²°í• ì§€â€™ì— ë°”ë¡œ ë„ì›€ì´ ë˜ë„ë¡**

---

## âœ… ìµœì¢… ë¦¬íŒ©í† ë§ëœ MDC ê·œì¹™: Hexagonal + DDD êµ¬ì¡° ê°€ì´ë“œ

> ğŸ“ `flower` ë˜ëŠ” `user` ë„ë©”ì¸ì„ ì°¸ê³ í•˜ì—¬ `cart`, `order` ë“± ìƒˆ ë„ë©”ì¸ì„ ê°œë°œí•  ë•Œ ë”°ë¼ì•¼ í•  í‘œì¤€ ê·œì¹™ì…ë‹ˆë‹¤.

---

### 1ï¸âƒ£ í´ë” êµ¬ì¡°

```
{domain}/
â”œâ”€â”€ adapter
â”‚   â”œâ”€â”€ in/graphql/
â”‚   â”‚   â”œâ”€â”€ datafetcher/   # @DgsQuery/@DgsMutation
â”‚   â”‚   â”œâ”€â”€ dataloader/    # N+1 ëŒ€ì‘ìš© DataLoader
â”‚   â”‚   â””â”€â”€ mapper/        # GraphQL DTO â†” Command/Result ë§¤í•‘
â”‚   â””â”€â”€ out/persistence/
â”‚       â”œâ”€â”€ entity/        # JPA Entity (BaseJpo ìƒì†)
â”‚       â”œâ”€â”€ mapper/        # Jpo â†” Domain ë³€í™˜
â”‚       â””â”€â”€ repository/    # Repository êµ¬í˜„ì²´ (Query/Crud ì¡°í•©)
â”œâ”€â”€ application
â”‚   â”œâ”€â”€ command/           # ì™¸ë¶€ ìš”ì²­ ë³€í™˜ìš© Command
â”‚   â”œâ”€â”€ result/            # ë„ë©”ì¸ ê²°ê³¼ë¥¼ ì™¸ë¶€ë¡œ ë°˜í™˜
â”‚   â”œâ”€â”€ port/outbound/     # ì™¸ë¶€ ì—°ê²°ìš© ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ service/           # @Transactional, UseCase ì¡°í•©
â”‚   â””â”€â”€ usecase/           # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â””â”€â”€ domain
    â”œâ”€â”€ model/             # í•µì‹¬ ë„ë©”ì¸ ì—”í‹°í‹°
    â””â”€â”€ vo/                # ê°’ ê°ì²´ (íƒ€ì… ì•ˆì •ì„±)
```
### 1-1. dgs-codegen ìƒì„±ëœ íŒŒì¼ ìœ„ì¹˜
```
build/generated/sources/dgs-codegen/kr/co/marketbill/marketbillcoreserver/types
```
---

### 2ï¸âƒ£ ê³„ì¸µë³„ ì—­í• 

| ê³„ì¸µ              | ì„¤ëª…                                         |
| --------------- | ------------------------------------------ |
| **domain**      | ë„ë©”ì¸ ëª¨ë¸ ë° VO. ì™¸ë¶€ ì˜ì¡´ ì—†ìŒ. ìƒì„±/ê²€ì¦/í–‰ìœ„ í¬í•¨         |
| **application** | Command/Result â†” Domain ë³€í™˜, íŠ¸ëœì­ì…˜ ê´€ë¦¬, í¬íŠ¸ ì •ì˜ |
| **adapter**     | ì‹¤ì œ API ìš”ì²­ ì²˜ë¦¬ ë° ì˜ì†í™” êµ¬í˜„. GraphQL ëŒ€ì‘, DB ì ‘ê·¼ ë“± |

---

### 3ï¸âƒ£ ë§¤í•‘ ë° ì±…ì„ ê·œì¹™

* `Jpo â†” Domain`: **Domain ë‚´ë¶€** `fromJpo`, `toJpo` ë˜ëŠ” **Mapper í´ë˜ìŠ¤**
* `Command/Result â†” Domain`: **Domain ë‚´ë¶€** ë˜ëŠ” `Mapper`
* `GraphQL DTO â†” Command/Result`: `adapter/in/graphql/mapper`ì—ì„œ ì²˜ë¦¬

---

### 4ï¸âƒ£ ëª…ëª… ê·œì¹™

```kotlin
// Domain
data class Cart(...)                   // í•µì‹¬ ë„ë©”ì¸ ê°ì²´
@JvmInline value class CartId(...)     // ID VO

// Application
data class CartSearchCommand(...)
data class CartSearchResult(...)
class CartService
class CartSearchUseCase
interface CartRepository               // Port

// Adapter
class CartFetcher(...)                 // @DgsComponent
class CartFieldFetcher(...)                 // @DgsComponent
object CartOutputMapper
data class CartRequest(...)
```

---

### 5ï¸âƒ£ ì˜ì¡´ì„± ë°©í–¥ ê·œì¹™

```
Adapter(in/out) â†’ Application â†’ Domain
```

âŒ ë‹¤ìŒì€ ì ˆëŒ€ ê¸ˆì§€:

```
Domain â†’ Application
Domain â†’ Adapter
Application â†’ Adapter
Adapter â†’ ë‹¤ë¥¸ Adapter
```

---

### 6ï¸âƒ£ ì„œë¹„ìŠ¤ & ìœ ìŠ¤ì¼€ì´ìŠ¤ ì‘ì„±

* `@Service`ëŠ” íŠ¸ëœì­ì…˜ ê²½ê³„ ë° ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°í•© ì—­í• ë§Œ ìˆ˜í–‰
* ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ëŠ” UseCaseì—ì„œ ì²˜ë¦¬
* Portë¥¼ í†µí•´ ì™¸ë¶€ì™€ ì—°ê²°

---

### 7ï¸âƒ£ Repository êµ¬í˜„ ë°©ì‹

```kotlin
@Repository
class CartRepositoryImpl(
    private val cartQueryRepository: CartQueryRepository, // ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë§Œ(ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ querydslë¡œë§Œ ê°€ëŠ¥í•œ ê²½ìš°)
    private val crudRepository: CartCrudRepository // ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë§Œ(ê°„ë‹¨í•œ JpaRepository crud ì¿¼ë¦¬ê°€ í•„ìš”í•œê²½ìš°)
) : CartRepository {
    override fun save(cart: Cart): Cart = ...
}
```

êµ¬ì„± ìš”ì†Œ:

* `CrudRepository`: ë‹¨ìˆœ CRUD
* `QueryRepository`: QueryDSL ë“± ë³µì¡í•œ ì¡°ê±´ ëŒ€ì‘
* JPO - Domain ë§¤í•‘ì€ ë„ë©”ì¸ëª¨ë¸ì— ìˆëŠ” ì •ì  ë©”ì„œë“œë¡œ ì²˜ë¦¬(ì ˆëŒ€ Mapper ì‚¬ìš©ê¸ˆì§€)
---

### 8ï¸âƒ£ JPA Entity ê·œì¹™

```kotlin
@Entity
@Table(name = "cart")
class CartJpo(
    @Id
    @GeneratedValue
    val id: Long? = null,
    ...
) : BaseJpo()
```

* `BaseJpo` ìƒì† í•„ìˆ˜
* `equals()/hashCode()` ì˜¤ë²„ë¼ì´ë“œ(í•„ìˆ˜)
* ê´€ê³„ ë§¤í•‘ ì‹œ **LAZY ê¸°ë³¸**, `orphanRemoval = true` ì ìš© ì—¬ë¶€ í™•ì¸

---

### 9ï¸âƒ£ GraphQL Fetcher & DataLoader

* ëª¨ë“  ì§„ì…ì ì€ `Fetcher`ì— `@DgsComponent`ë¡œ ì •ì˜
* ì‘ë‹µ íƒ€ì…ì€ ë°˜ë“œì‹œ **`types` íŒ¨í‚¤ì§€ì˜ DGS Codegen íƒ€ì… ì‚¬ìš©**(ê²½ë¡œ : {root}/build/generated/sources/dgs-codegen/kr/co/marketbill/marketbillcoreserver/types)
* N+1 ì´ìŠˆ ì˜ˆìƒ ì‹œ `DataLoader` êµ¬í˜„

#### 9-1. â—GraphQLì€ ì°¸ê³ ë§Œ, ì ˆëŒ€ ìˆ˜ì •í•˜ì§€ ë§ ê²ƒ
resources/schema/{ë„ë©”ì¸ëª…}.graphql ì€ ê³ ì •ëœ ê³„ì•½(Contract)

ìƒˆ í•„ë“œ/ì¿¼ë¦¬ê°€ í•„ìš”í•˜ë©´ íŒ€ì— ìš”ì²­

#### 9-2. âœ… DataFetcher ì‘ì„± ì›ì¹™
| í•­ëª©    | ê·œì¹™                                                       |
| ----- | -------------------------------------------------------- |
| ìœ„ì¹˜    | `adapter/in/graphql/datafetcher/`                        |
| ì–´ë…¸í…Œì´ì…˜ | `@DgsComponent`, `@DgsQuery`, `@DgsMutation`, `@DgsData`(ë‚´ë¶€ì— ë“¤ì–´ê°€ëŠ” parentType, fieldëŠ” DgsConstant(build/generated/sources/dgs-codegen/kr/co/marketbill/marketbillcoreserver/DgsConstants.kt)ë¥¼ ì°¸ê³ ) |
| ì±…ì„    | Service í˜¸ì¶œ â†’ Command ì „ë‹¬ â†’ Result ë°˜í™˜                      |
| ë°˜í™˜    | ë°˜ë“œì‹œ `types` íŒ¨í‚¤ì§€ì˜ Codegen íƒ€ì… ì‚¬ìš©                           |


âœ… DataLoader ì‘ì„± ì›ì¹™
| í•­ëª©    | ê·œì¹™                                  |
| ----- | ----------------------------------- |
| ìœ„ì¹˜    | `adapter/in/graphql/dataloader/`    |
| ì–´ë…¸í…Œì´ì…˜ | `@DgsDataLoader`                    |
| ë¡œë”© ë°©ì‹ | `MappedBatchLoaderWithContext` êµ¬í˜„   |
| ìš©ë„    | GraphQLì˜ N+1 ë¬¸ì œ í•´ê²°. ì—°ê´€ê´€ê³„ê°€ ì¡´ì¬í•  ë•Œë§Œ ì‚¬ìš© |
| ì¸ì ì „ë‹¬    | DataFetcherì—ì„œ dataloader.load(ids, {contextê°ì²´})ë¡œ ì „ë‹¬í•˜ê³  dataloaderì—ì„œ environment.keyContextsë¡œ ë°›ìŒ |



---

### ğŸ”Ÿ í…ŒìŠ¤íŠ¸ êµ¬ì¡° (src/test)

```
{domain}/
â”œâ”€â”€ domain/
â”œâ”€â”€ application/
â””â”€â”€ adapter/
```

í…ŒìŠ¤íŠ¸ ëª…ëª…:

```kotlin
class CartServiceTest
class CartSearchUseCaseTest
class CartFetcherTest
```

---

### âœ… ìƒì„± ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½

| ê³„ì¸µ              | ì²´í¬ë¦¬ìŠ¤íŠ¸                                                   |
| --------------- | ------------------------------------------------------- |
| **domain**      | `data class`, VOëŠ” `@JvmInline`, ìœ íš¨ì„± ê²€ì‚¬ í¬í•¨               |
| **application** | `fromGraphql`/`from()` íŒ©í† ë¦¬ ë©”ì„œë“œ, UseCaseëŠ” ë¡œì§ë§Œ            |
| **adapter**     | DTO â†’ Command â†’ Service â†’ Result â†’ DTO êµ¬ì¡° ì¤€ìˆ˜            |
| **repository**  | Query + Crud + Mapper ì¡°í•©, MapperëŠ” `@Component`          |
| **graphql**     | DTO â†” Command/Result ë§¤í•‘ì€ `OutputMapper`, íƒ€ì…ì€ `types` ì‚¬ìš© |

---

### 11. ğŸ¯ í•„ìˆ˜ ê°œë°œ ìˆœì„œ
ì‘ì—…ì€ ë°˜ë“œì‹œ ë‹¤ìŒ ìˆœì„œë¡œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤:

1. GraphQL ìŠ¤í‚¤ë§ˆ í™•ì¸

- resources/schema/{ë„ë©”ì¸ëª…}.graphqlì„ ì—´ëŒ

- ìŠ¤í‚¤ë§ˆëŠ” ì ˆëŒ€ ìˆ˜ì •í•˜ì§€ ë§ê³ , í•´ë‹¹ ì¿¼ë¦¬/í•„ë“œ ëª…ì„¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ êµ¬í˜„

2. ë„ë©”ì¸ ì •ì˜ (domain/model, domain/vo)

- GraphQLì—ì„œ ì‚¬ìš©ë˜ëŠ” Entityì— í•´ë‹¹í•˜ëŠ” ë„ë©”ì¸ ëª¨ë¸ ìƒì„±

- VO ì •ì˜ ë° ìœ íš¨ì„± ê²€ì‚¬ í¬í•¨

3. Command/Result ì •ì˜ (application/command, result)

- GraphQL Input â†’ Command

- Domain â†’ Result â†’ Outputìœ¼ë¡œ íë¦„ ì„¤ê³„

4. UseCase êµ¬í˜„ (application/usecase)

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬ì„±

- ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²°ì€ Portë¥¼ í†µí•´ ì ‘ê·¼

5. Port ì¸í„°í˜ì´ìŠ¤ ì •ì˜ (application/port/outbound)

6. Service êµ¬í˜„ (application/service)

- UseCase ì¡°í•©, íŠ¸ëœì­ì…˜ ê´€ë¦¬

- ë„ë©”ì¸ ëª¨ë¸ ë©”ì„œë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ (ì—­ì°¸ì¡° ê¸ˆì§€)

7. Persistence êµ¬í˜„ (adapter/out/persistence)

- Repository, Entity(Jpo), Mapper

8. GraphQL Adapter êµ¬í˜„ (adapter/in/graphql)

- datafetcher/, dataloader/, mapper/ ì‘ì„±

- ë°˜ë“œì‹œ schema/{ë„ë©”ì¸ëª…}.graphql ê¸°ë°˜ìœ¼ë¡œë§Œ êµ¬í˜„

#### 11-1. ğŸš« ì˜ëª»ëœ ì‘ì—… ë°©ì‹ ì˜ˆì‹œ
âŒ GraphQL ìŠ¤í‚¤ë§ˆë¥¼ ë¨¼ì € ìˆ˜ì •í•˜ê³  Fetcherë¥¼ êµ¬í˜„

âŒ domain/model ì—†ì´ ë¨¼ì € Service ì‘ì„±

âŒ VOë‚˜ Commandê°€ ì—†ëŠ” ìƒíƒœì—ì„œ UseCaseë¶€í„° ì‘ì„±

âŒ Mapper ì—†ì´ DTO â†” Entity ì§ì ‘ ë³€í™˜

â†’ ìœ„ ë°©ì‹ì€ ì „ë¶€ ì»´íŒŒì¼ ì˜¤ë¥˜ / êµ¬ì¡° ì˜¤ì—¼ / ì¤‘ë³µ ë¡œì§ì„ ìœ ë°œí•©ë‹ˆë‹¤.

#### 11-2. âœ… ì˜¬ë°”ë¥¸ íë¦„ ì˜ˆì‹œ
GraphQLì— getOrders(filter: OrderFilterInput): OrdersOutputì´ ìˆë‹¤ë©´ 
- Order.kt, OrderId.kt ë“±ì˜ ë„ë©”ì¸ ì‘ì„±
- OrderSearchCommand, OrderSearchResult ì‘ì„±
- OrderSearchUseCaseì—ì„œ ì¡°ê±´ ì¡°íšŒ ë¡œì§ êµ¬í˜„
- OrderServiceì—ì„œ íŠ¸ëœì­ì…˜ ì œì–´ ë° ìœ ìŠ¤ì¼€ì´ìŠ¤ í˜¸ì¶œ
- OrderFetcherì—ì„œ Input â†’ Command â†’ Result â†’ Output ë³€í™˜(ì—¬ê¸°ì„œ N+1ë¬¸ì œê°€ ìˆì„ ê±° ê°™ìœ¼ë©´ Dataloader, FieldFetcher ì¶”ê°€ êµ¬í˜„)
- OrderOutputMapperì—ì„œ DGS íƒ€ì…ìœ¼ë¡œ ìµœì¢… ë³€í™˜